---
title: "Examination of the value of eco-labeled products"
output: word_document
---

```{r setup, include=FALSE, echo=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(BEST)   # for Bayesian t tests
library(BANOVA)  # Bayesian ANOVAs

signif.fun <- function(x) return(ifelse((x[2] < 0 & x[3] < 0), "-",
                                               ifelse((x[2] < 0 & x[3] > 0), ".",
                                                      ifelse((x[2] > 0 & x[3] > 0), "+"))))

get.dif.stats <- function(x){
  mu.dif.lo <- unlist(lapply(x, 
                             FUN = function(x) {return(ifelse(!is.null(x), 
                                                              summary(x)["muDiff", "HDIlo"], 
                                                              NA))})) 
  
  mu.dif.up <- unlist(lapply(x, 
                             FUN = function(x) {return(ifelse(!is.null(x), 
                                                              summary(x)["muDiff", "HDIup"], 
                                                              NA))}) )
  
  mu.dif.median <- unlist(lapply(x, 
                                 FUN = function(x) {return(ifelse(!is.null(x), 
                                                                  summary(x)["muDiff", "median"], 
                                                                  NA))}) )
  
  
  mu.dif.df <- data.frame(median = mu.dif.median, 
                          HDIlo = mu.dif.lo, 
                          HDIup = mu.dif.up)

  mu.dif <-   apply(mu.dif.df, 
                    MARGIN = 1, 
                    FUN = signif.fun)
  
  # mu.dif <- apply(mu.dif.df, 
  #                 MARGIN = 1, 
  #                 FUN = function(x){return(ifelse((x[2] < 0 & x[3] < 0), -1,
  #                                                 ifelse((x[2] < 0 & x[3] > 0), 0,
  #                                                        ifelse((x[2] > 0 & x[3] > 0), 1))))})
  
  mu.dif.df$signif <- mu.dif     
  return(mu.dif.df)
  
}
```

Categorical comparisons – product (with eco-label attribute) vs price

```{r get_data, echo=FALSE, include=FALSE}
col.def <- cols("YEAR" = col_integer(),
                "MONTH" = col_integer(),
                "DAY" = col_integer(),
                "DATE" = col_date(format = "%m/%d/%y"),
                "ZIP" = col_integer(),
                "LATITUDE" = col_double(),
                "LONGITUDE" = col_double(),
                "MKT_NAME" = col_character(),
                "MARKETNAME" = col_integer(),
                "MARKETTYPE" = col_integer(),
                "FULL_LABEL" = col_character(),
                "COMMON_NAME" = col_character(),
                "LENGTH_CM" = col_double(),
                "FOODGRP" = col_character(),
                "SPP_GROUP" = col_character(),
                "DSPPGRP" = col_integer(),
                "SPECIES" = col_character(),
                "FAMILY" = col_character(),
                "TL" = col_double(),
                "K_YR" = col_double(),
                "PRICE" = col_double(),
                "DCOUNTRY" = col_integer(),
                "COUNTRY" = col_character(),
                "DCONDITION" = col_integer(),
                "CONDITION" = col_character(),
                "PRODUCT_TYPE" = col_character(),
                "BRAND_NAME" = col_character(),
                "PROD_METHOD" = col_integer(),
                "KEYWORD" = col_character(),
                "ECOLABEL" = col_character(),
                "SFW_RATING" = col_integer(),
                "WILD" = col_integer(),
                "FARMED" = col_integer(),
                "FRESH" = col_integer(),
                "HVINVERT" = col_integer(),
                "SHRIMP" = col_integer(),
                "LOCAL" = col_integer(),
                "LIVE" = col_integer(),
                "SUSHI" = col_integer(),
                "RESPONSIBLE" = col_integer(),
                "MSC" = col_integer(),
                "SUSTAINABLE" = col_integer(),
                "MBA" = col_integer(),
                "MBA_CARD" = col_integer(),
                "MBA_APP" = col_integer(),
                "BAP" = col_integer(),
                "DBAPSTARS" = col_integer(),
                "BAP_LEVEL" = col_character(),
                "REGION" = col_character(),
                "GEAR" = col_character(),
                "SIZE_CLASS" = col_character(),
                "SHRIMP_PROCESSING" = col_character(),
                "DPROCCOUNTRY" = col_integer(),
                "PROCESSING_COUNTRY" = col_character(),
                "HACCP" = col_integer(),
                "SIZE_GROUP" = col_character(),
                "DOLPHIN_SAFE" = col_character(),
                "OTHER_TEXT" = col_character(),
                "GF" = col_character(),
                "O3" = col_character(),
                "NONGMO" = col_integer(),
                "SUSTAIN-" = col_integer(),
                "TRAC-" = col_integer(),
                "USA STATE" = col_character())

main.data <- read_csv(file = "data/SDSEAFOOD_Master_02042019_2.csv",
                      col_types = col.def)

# Bring in the keys:
key_country <- read.csv(file = "data/SDSEAFOOD_KEY_DCOUNTRY_02012019_1.csv")
key_condition <- read.csv(file = "data/SDSEAFOOD_KEY_DCONDITION_02012019_1.csv")
key_food.grp <- read.csv(file = "data/SDSEAFOOD_KEY_DFOODGRP_02012019_1.csv")
key_market.name <- read.csv(file = "data/SDSEAFOOD_KEY_DMARKETNAME_02012019_1.csv")
key_market.type <- read.csv(file = "data/SDSEAFOOD_KEY_DMARKETTYPE_02012019_1.csv")
key_MBA <- read.csv(file = "data/SDSEAFOOD_KEY_DMBA_X_02012019_1.csv")
key_spp.grp <- read.csv(file = "data/SDSEAFOOD_KEY_DSPPGRP_02012019_1.csv")

```


# 1.	What is the average price of eco-labeled seafood vs non-ecolabeled seafood of the same species?

## A.	Monterey Bay Aquarium (MBA) Green/Yellow (fresh products only; this is the Whole Foods “effect”)
Should I take out products with other ecolabels? 

### MBA
```{r get_MBA, echo=FALSE, include=FALSE}
# then filter away!
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION,
         MBA, MSC, BAP) %>%
  filter(DCONDITION == 2)  %>%  # Fresh only
  filter(is.na(MSC))  %>% # remove MSC certified
  filter(is.na(BAP))  %>% # remove BAP certified
  mutate(MBA_1_2 = ifelse(is.na(MBA), 2, 
                          ifelse((MBA == 1 | MBA == 2), 1, 2))) %>%
  left_join(key_spp.grp, by = "DSPPGRP") -> MBA.data

# find which levels are available as pairs:
MBA.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MBA_1_2 == 1) %>%
  summarize(n = n()) -> MBA_1.summary

MBA.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MBA_1_2 == 2) %>%
  summarize(n = n()) -> MBA_2.summary

common.levels <- intersect(unique(MBA_1.summary$`as.factor(DSPPGRP)`),
                           unique(MBA_2.summary$`as.factor(DSPPGRP)`))

MBA.data <- MBA.data[MBA.data$DSPPGRP %in% common.levels,]

# MBA.data %>% group_by(as.factor(MBA_1_2), DSPPGRP) %>%
#   summarize(n = n()) -> MBA.summary


```


```{r MBA_tests, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/MBA_test_results.rds")){
  BESTout <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    MBA.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(MBA_1_2, PRICE) -> tmp
    
    tmp %>% filter(MBA_1_2 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(MBA_1_2 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout[[k]] <- BESTmcmc(y1, y2,
                               numSavedSteps = 10000,
                               burnInSteps = 5000,
                               thinSteps = 5,
                               parallel = TRUE)
      
    }
  }
  
  saveRDS(BESTout, "RData/MBA_test_results.rds")
  
} else {
  BESTout <- readRDS("RData/MBA_test_results.rds")
}

mu.dif.BEST <- get.dif.stats(BESTout)

mu.dif.BEST$DSPPGRP <- common.levels

MBA.data %>% group_by(MBA_1_2, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(MBA_1_2 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(MBA_1_2 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)
```

 

```{r plot_MBA, echo=FALSE, warning = FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of seafood products between those with and without MBA 1 and 2 labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}

ggplot(MBA.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, 
                   color = as.factor(MBA_1_2)))+
  scale_color_discrete(labels = c("MBA 1&2", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", 
       title = "MBA 1&2, Fresh products only") +
  geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = ceiling(max(MBA.data$PRICE)),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.BEST,
            aes(x = as.factor(DSPPGRP), 
                y = max(MBA.data$PRICE) + 10, 
                label = signif),
            size = 10)

```

The mean price was higher with MBA certificate than without for species groups 5 (groupers, seabass, snappers and rockfish), 10 (other marine and imitation fish), 11 (salmon), and 15 (tunas, jacks, sportfish and sharks), whereas it was less with MBA certificate than without for the species group 6 (Halibuts and flatfishes).  No difference was found for the species group 3 (Cods and cod-like).  There were not enough data for MBA for groups 4 (crabs and lobster), 9 (other invertebrates), and 12 (schooling fish). 

## B.	Marine Stewardship Council (MSC) certification
```{r MSC_data, echo=FALSE, include=FALSE}

main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION,
         MBA, MSC, BAP) %>%
  filter(is.na(MBA)) %>%
  filter(is.na(BAP)) %>%
  mutate(MSC_1 = ifelse(is.na(MSC), 2, 1)) %>%
  left_join(key_spp.grp, by = "DSPPGRP") -> MSC.data

# find which levels are available as pairs:
MSC.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 1) %>%
  summarize(n = n()) -> MSC_1.summary

MSC.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 2) %>%
  summarize(n = n()) -> MSC_2.summary

common.levels <- intersect(unique(MSC_1.summary$`as.factor(DSPPGRP)`),
                           unique(MSC_2.summary$`as.factor(DSPPGRP)`))

MSC.data <- MSC.data[MSC.data$DSPPGRP %in% common.levels,]

MSC.data %>% group_by(MSC_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(MSC_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(MSC_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)

```


```{r MSC_tests, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/MSC_test_results.rds")){

  BESTout.MSC <- vector(mode = "list", length = length(common.levels))
  
  k <- 1
  for (k in 1:length(common.levels)){
    MSC.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(MSC_1, PRICE) -> tmp
    
    tmp %>% filter(MSC_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(MSC_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.MSC[[k]] <- BESTmcmc(y1, y2,
                                   numSavedSteps = 10000,
                                   burnInSteps = 5000,
                                   thinSteps = 5,
                                   parallel = TRUE)
      
    }
  }
  saveRDS(BESTout.MSC, "RData/MSC_test_results.rds")
} else {
  BESTout.MSC <- readRDS("RData/MSC_test_results.rds")
  
}  

mu.dif.MSC <- get.dif.stats(BESTout.MSC)

mu.dif.MSC$DSPPGRP <- common.levels

```


```{r plot_MSC, echo=FALSE, warning = FALSE,fig.width=8, fig.height=6, fig.cap="Comparison of the price of seafood products between those with and without MSC. Y axis is in the base 10 logarithmic scale.  A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR.  Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}

ggplot(MSC.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = log10(PRICE), 
                   color = as.factor(MSC_1)))+
  scale_color_discrete(labels = c("MSC", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", y = "log10(price)", title = "MSC") + 
  geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = log10(ceiling(max(MSC.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.MSC,
            aes(x = as.factor(DSPPGRP), 
                y = log10(ceiling(max(MSC.data$PRICE))) + 0.5, 
                label = signif),
            size = 10)
```

The mean price was higher with MSC than without for all species groups except 2 (bivalves) and 11 (salmon). 


### Fresh; frozen; shelf stable products run separately 
#### Fresh
```{r Fresh_data, echo=FALSE, include=FALSE}
MSC.data %>% 
  filter(DCONDITION == 2) %>% 
  filter(is.na(MBA)) %>%
  filter(is.na(BAP)) -> MSC.fresh.data


# find which levels are available as pairs:
MSC.fresh.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 1) %>%
  summarize(n = n()) -> MSC.fresh_1.summary

MSC.fresh.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 2) %>%
  summarize(n = n()) -> MSC.fresh_2.summary

common.levels <- intersect(unique(MSC.fresh_1.summary$`as.factor(DSPPGRP)`),
                           unique(MSC.fresh_2.summary$`as.factor(DSPPGRP)`))

MSC.fresh.data <- MSC.fresh.data[MSC.fresh.data$DSPPGRP %in% common.levels,]

MSC.fresh.data %>% group_by(MSC_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(MSC_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(MSC_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)
```


```{r MSC_tests_fresh, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/MSC_fresh_test_results.rds")){

  BESTout.MSC.fresh <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    MSC.fresh.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(MSC_1, PRICE) -> tmp
    
    tmp %>% filter(MSC_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(MSC_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.MSC.fresh[[k]] <- BESTmcmc(y1, y2,
                                         numSavedSteps = 10000,
                                         burnInSteps = 5000,
                                         thinSteps = 5,
                                         parallel = TRUE)
      
    }
  }
  
  saveRDS(BESTout.MSC.fresh, "RData/MSC_fresh_test_results.rds")
} else {
  BESTout.MSC.fresh <- readRDS("RData/MSC_fresh_test_results.rds")
}

mu.dif.MSC.fresh <- get.dif.stats(BESTout.MSC.fresh)

mu.dif.MSC.fresh$DSPPGRP <- common.levels

# p.dif.gt.0 <- unlist(lapply(BESTout.MSC.fresh, 
#                             FUN = function(x) {return(ifelse(!is.null(x), 
#                                                              summary(x)["muDiff", "%>compVal"], 
#                                                              NA))})) * 0.01
# 
# p.dif.gt.0.df <- data.frame(DSPPGRP = common.levels,
#                             p = p.dif.gt.0)
```

```{r plot_MSC_Fresh, echo=FALSE, warning = FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of fresh seafood products between those with and without MSC labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}
ggplot(MSC.fresh.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, color = as.factor(MSC_1)))+
  scale_color_discrete(labels = c("MSC", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", title = "MSC Fresh") + 
   geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = (ceiling(max(MSC.fresh.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.MSC.fresh,
            aes(x = as.factor(DSPPGRP), 
                y = max(MSC.fresh.data$PRICE) + 10, 
                label = signif),
            size = 10)

```

For fresh products, the mean price was higher with MSC than without for the species group 6 (halibuts and flatfishes) but no difference was detected for the species groups 2 (bivalves), 3 (cods and cod-likes), and 11 (salmon), whereas there was not enough data for the species group 15 (tunas, jacks, sportfish and sharks). 


#### Frozen

```{r MSC_frozen, echo=FALSE, include=FALSE}
MSC.data %>% 
  filter(DCONDITION == 5 | DCONDITION == 6) %>% 
  filter(is.na(MBA)) %>%
  filter(is.na(BAP)) -> MSC.frozen.data

# find which levels are available as pairs:
MSC.frozen.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 1) %>%
  summarize(n = n()) -> MSC.frozen_1.summary

MSC.frozen.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 2) %>%
  summarize(n = n()) -> MSC.frozen_2.summary

common.levels <- intersect(unique(MSC.frozen_1.summary$`as.factor(DSPPGRP)`),
                           unique(MSC.frozen_2.summary$`as.factor(DSPPGRP)`))

MSC.frozen.data <- MSC.frozen.data[MSC.frozen.data$DSPPGRP %in% common.levels,]

MSC.frozen.data %>% group_by(MSC_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(MSC_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(MSC_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)
```

```{r MSC_tests_frozen, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/MSC_frozen_test_results.rds")){

  BESTout.MSC.frozen <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    MSC.frozen.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(MSC_1, PRICE) -> tmp
    
    tmp %>% filter(MSC_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(MSC_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.MSC.frozen[[k]] <- BESTmcmc(y1, y2,
                                   numSavedSteps = 10000,
                                   burnInSteps = 5000,
                                   thinSteps = 5,
                                   parallel = TRUE)
      
    }
  }
  
  saveRDS(BESTout.MSC.frozen, "RData/MSC_frozen_test_results.rds")
} else {
  BESTout.MSC.frozen <- readRDS("RData/MSC_frozen_test_results.rds")
}


mu.dif.MSC.frozen <- get.dif.stats(BESTout.MSC.frozen)

mu.dif.MSC.frozen$DSPPGRP <- common.levels

```

```{r MSC_frozen_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of frozen seafood products between those with and without MSC labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}
ggplot(MSC.frozen.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, color = as.factor(MSC_1)))+
  scale_color_discrete(labels = c("MSC", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", title = "MSC Frozen") + 
  geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = (ceiling(max(MSC.frozen.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.MSC.frozen,
            aes(x = as.factor(DSPPGRP), 
                y = max(MSC.frozen.data$PRICE) + 10, 
                label = signif),
            size = 10)
```

For frozen products, the mean price was higher with MSC than without for the species groups 3 (cods and cod-likes), 5 (groupers, seabass, snappers, and rockfishes), and 15 (tunas, jacks, sportfish and sharks), whereas they were less for the species group 11 (salmon).  No difference was found for others. 


#### Shelf-stable
```{r MSC_ss, echo=FALSE, include=FALSE}
MSC.data %>% 
  filter(DCONDITION == 7 | DCONDITION == 8) %>% 
  filter(is.na(MBA)) %>%
  filter(is.na(BAP)) -> MSC.SS.data

# find which levels are available as pairs:
MSC.SS.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 1) %>%
  summarize(n = n()) -> MSC.SS_1.summary

MSC.SS.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(MSC_1 == 2) %>%
  summarize(n = n()) -> MSC.SS_2.summary

common.levels <- intersect(unique(MSC.SS_1.summary$`as.factor(DSPPGRP)`),
                           unique(MSC.SS_2.summary$`as.factor(DSPPGRP)`))

MSC.SS.data <- MSC.SS.data[MSC.SS.data$DSPPGRP %in% common.levels,]


MSC.SS.data %>% group_by(MSC_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(MSC_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(MSC_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)

```


```{r MSC_tests_SS, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/MSC_SS_test_results.rds")){

  BESTout.MSC.SS <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    MSC.SS.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(MSC_1, PRICE) -> tmp
    
    tmp %>% filter(MSC_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(MSC_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.MSC.SS[[k]] <- BESTmcmc(y1, y2,
                                   numSavedSteps = 10000,
                                   burnInSteps = 5000,
                                   thinSteps = 5,
                                   parallel = TRUE)
      
    
    }
  }
  
  saveRDS(BESTout.MSC.SS, "RData/MSC_SS_test_results.rds")
} else {
  BESTout.MSC.SS <- readRDS("RData/MSC_SS_test_results.rds")
}


mu.dif.MSC.SS <- get.dif.stats(BESTout.MSC.SS)

mu.dif.MSC.SS$DSPPGRP <- common.levels

```


```{r MSC_SS_plot, echo=FALSE, warning=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of shelf-stable seafood products between those with and without MSC labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symobls on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}

ggplot(MSC.SS.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, color = as.factor(MSC_1)))+
  scale_color_discrete(labels = c("MSC", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", title = "MSC Shelf-stable") + 
  geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = (ceiling(max(MSC.SS.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.MSC.SS,
            aes(x = as.factor(DSPPGRP), 
                y = max(MSC.SS.data$PRICE) + 10, 
                label = signif),
            size = 10)

```

For shelf-stable products, the mean price was higher with MSC than without for the species groups 11 (salmon), 12 (schooling fish), and 15 (tunas, jacks, sportfish, and sharks), whereas it was less for the species group 2 (crabs and lobster).  Not enough data were available for 13 (shrimp).   


## C.	Best Aquaculture Practices (BAP)
Identify the species that have these labels – if this isn’t straightforward, we will help.

Please compare average price/lb of the same species with and without these labels, within product type category (fresh w eco-label vs. fresh non-ecolabel, frozen w ecolabel vs. frozen without ecolabel, shelf stable w ecolabel vs. shelf stable without ecolabel)

```{r BAP_data, echo=FALSE, include=FALSE}

main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION,
         MBA, MSC, BAP) %>%
  filter(is.na(MBA)) %>%
  filter(is.na(MSC)) %>%
  mutate(BAP_1 = ifelse(is.na(BAP), 2, 1)) %>%
  left_join(key_spp.grp, by = "DSPPGRP") -> BAP.data

# find which levels are available as pairs:
BAP.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 1) %>%
  summarize(n = n()) -> BAP_1.summary

BAP.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 2) %>%
  summarize(n = n()) -> BAP_2.summary

common.levels <- intersect(unique(BAP_1.summary$`as.factor(DSPPGRP)`),
                           unique(BAP_2.summary$`as.factor(DSPPGRP)`))

BAP.data <- BAP.data[BAP.data$DSPPGRP %in% common.levels,]

```


### a.	Fresh

```{r BAP_fresh, echo=FALSE, include=FALSE}
BAP.data %>% 
  filter(DCONDITION == 2) -> BAP.fresh.data

# find which levels are available as pairs:
BAP.fresh.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 1) %>%
  summarize(n = n()) -> BAP.fresh_1.summary

BAP.fresh.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 2) %>%
  summarize(n = n()) -> BAP.fresh_2.summary

common.levels <- intersect(unique(BAP.fresh_1.summary$`as.factor(DSPPGRP)`),
                           unique(BAP.fresh_2.summary$`as.factor(DSPPGRP)`))

BAP.fresh.data <- BAP.fresh.data[BAP.fresh.data$DSPPGRP %in% common.levels,]


BAP.fresh.data %>% group_by(BAP_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(BAP_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(BAP_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)
```


```{r BAP_tests_fresh, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/BAP_fresh_test_results.rds")){

  BESTout.BAP.fresh <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    BAP.fresh.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(BAP_1, PRICE) -> tmp
    
    tmp %>% filter(BAP_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(BAP_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.BAP.fresh[[k]] <- BESTmcmc(y1, y2,
                                         numSavedSteps = 10000,
                                         burnInSteps = 5000,
                                         thinSteps = 5,
                                         parallel = TRUE)
      
    }
  }
  
  saveRDS(BESTout.BAP.fresh, "RData/BAP_fresh_test_results.rds")
} else {
  BESTout.BAP.fresh <- readRDS("RData/BAP_fresh_test_results.rds")
}


mu.dif.BAP.fresh <- get.dif.stats(BESTout.BAP.fresh)

mu.dif.BAP.fresh$DSPPGRP <- common.levels

```

```{r BAP_fresh_plot, echo=FALSE, warning=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of fresh seafood products between those with and without BAP labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}
ggplot(BAP.fresh.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, color = as.factor(BAP_1)))+
  scale_color_discrete(labels = c("BAP", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", title = "BAP Fresh") + 
   geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = (ceiling(max(BAP.fresh.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.BAP.fresh,
            aes(x = as.factor(DSPPGRP), 
                y = max(BAP.fresh.data$PRICE) + 5, 
                label = signif),
            size = 10)

```

There were only two available groups in this category (11: salmon and 14: tilapia and freshwater species) and the mean price was less with BAP for salmon and no difference was found for tilapia and freshwater species.  

### Frozen products	

```{r BAP_frozen, echo=FALSE, include=FALSE, warning=FALSE}
BAP.data %>% 
  filter(DCONDITION == 5 | DCONDITION == 6) -> BAP.frozen.data

# find which levels are available as pairs:
BAP.frozen.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 1) %>%
  summarize(n = n()) -> BAP.frozen_1.summary

BAP.frozen.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 2) %>%
  summarize(n = n()) -> BAP.frozen_2.summary

common.levels <- intersect(unique(BAP.frozen_1.summary$`as.factor(DSPPGRP)`),
                           unique(BAP.frozen_2.summary$`as.factor(DSPPGRP)`))

BAP.frozen.data <- BAP.frozen.data[BAP.frozen.data$DSPPGRP %in% common.levels,]

BAP.frozen.data %>% group_by(BAP_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(BAP_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(BAP_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)
```

```{r BAP_tests_frozen, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/BAP_frozen_test_results.rds")){

  BESTout.BAP.frozen <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    BAP.frozen.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(BAP_1, PRICE) -> tmp
    
    tmp %>% filter(BAP_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(BAP_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.BAP.frozen[[k]] <- BESTmcmc(y1, y2,
                                          numSavedSteps = 10000,
                                          burnInSteps = 5000,
                                          thinSteps = 5,
                                          parallel = TRUE)
      
    }
  }
  
  saveRDS(BESTout.BAP.frozen, "RData/BAP_frozen_test_results.rds")
} else {
  BESTout.BAP.frozen <- readRDS("RData/BAP_frozen_test_results.rds")
}


mu.dif.BAP.frozen <- get.dif.stats(BESTout.BAP.frozen)

mu.dif.BAP.frozen$DSPPGRP <- common.levels
# 
# p.dif.gt.0 <- unlist(lapply(BESTout.BAP.frozen, 
#                             FUN = function(x) {return(ifelse(!is.null(x), 
#                                                              summary(x)["muDiff", "%>compVal"], 
#                                                              NA))})) * 0.01
# 
# p.dif.gt.0.df <- data.frame(DSPPGRP = common.levels,
#                             p = p.dif.gt.0)
```

```{r BAP_frozen_plot, echo=FALSE, warning=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of frozen seafood products between those with and without BAP labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Symbols on top indicate whether the mean for MBA labels was greater (+), smaller (-), or not different (.) from those without the labels for each group. Values indicate the sample sizes."}
ggplot(BAP.frozen.data) +
  geom_boxplot(aes(x = as.factor(DSPPGRP), 
                   y = PRICE, color = as.factor(BAP_1)))+
  scale_color_discrete(labels = c("BAP", "Others")) + 
  guides(color = guide_legend(title = NULL)) +
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, 
                                   hjust = 1, size = 12)) +
  labs(x = "DSPPGRP", title = "BAP Frozen") + 
  geom_text(data = sample.size.wide,
            aes(x = as.factor(DSPPGRP1), 
                y = (ceiling(max(BAP.frozen.data$PRICE))),
                label = paste(n1, n2, sep = "/")),
            size = 3) + 
  geom_text(data = mu.dif.BAP.frozen,
            aes(x = as.factor(DSPPGRP), 
                y = max(BAP.frozen.data$PRICE) + 5, 
                label = signif),
            size = 10)
```

For frozen products with BAP labels, the mean price was higher with BAP than without for the species group 13 (shrimp), but less for the groups 2 (crabs and lobster) and 14 (tilapia and freshwater fishes).  There was not enough sample to compare for group 10 (other marine and imitation fish).     


#### Shelf-stable
None of SS products had BAP certificate.  So, no comparison made here. 

```{r BAP_ss_data, echo=FALSE, include=FALSE, warning=FALSE}
BAP.data %>% 
  filter(DCONDITION == 7 | DCONDITION == 8) -> BAP.SS.data

# find which levels are available as pairs:
BAP.SS.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 1) %>%
  summarize(n = n()) -> BAP.SS_1.summary

BAP.SS.data %>% group_by(as.factor(DSPPGRP)) %>% 
  filter(BAP_1 == 2) %>%
  summarize(n = n()) -> BAP.SS_2.summary

common.levels <- intersect(unique(BAP.SS_1.summary$`as.factor(DSPPGRP)`),
                           unique(BAP.SS_2.summary$`as.factor(DSPPGRP)`))

BAP.SS.data <- BAP.SS.data[BAP.SS.data$DSPPGRP %in% common.levels,]

BAP.SS.data %>% group_by(BAP_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

sample.size %>% filter(BAP_1 == 1) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP1 = DSPPGRP,
            n1 = n) -> sample.size.1

sample.size %>% filter(BAP_1 == 2) %>% select(DSPPGRP, n) %>%
  transmute(DSPPGRP2 = DSPPGRP,
            n2 = n)-> sample.size.2

sample.size.wide <- cbind(sample.size.1, sample.size.2)

```


```{r BAP_tests_SS, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/BAP_SS_test_results.rds")){

  BESTout.BAP.SS <- vector(mode = "list", length = length(common.levels))
  k <- 1
  for (k in 1:length(common.levels)){
    BAP.SS.data %>% filter(DSPPGRP == as.numeric(common.levels[k])) %>%
      select(BAP_1, PRICE) -> tmp
    
    tmp %>% filter(BAP_1 == 1) %>% 
      pull(PRICE) -> y1
    
    tmp %>% filter(BAP_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.BAP.SS[[k]] <- BESTmcmc(y1, y2,
                                   numSavedSteps = 10000,
                                   burnInSteps = 5000,
                                   thinSteps = 5,
                                   parallel = TRUE)
      
    
    }
  }
  
  saveRDS(BESTout.BAP.SS, "RData/BAP_SS_test_results.rds")
} else {
  BESTout.BAP.SS <- readRDS("RData/BAP_SS_test_results.rds")
}


mu.dif.BAP.SS <- get.dif.stats(BESTout.BAP.SS)

mu.dif.BAP.SS$DSPPGRP <- common.levels
# 
# p.dif.gt.0 <- unlist(lapply(BESTout.BAP.SS, 
#                             FUN = function(x) {return(ifelse(!is.null(x), 
#                                                              summary(x)["muDiff", "%>compVal"], 
#                                                              NA))})) * 0.01
# 
# p.dif.gt.0.df <- data.frame(DSPPGRP = common.levels,
#                             p = p.dif.gt.0)
```


<!-- ```{r BAP_SS_plot, echo=FALSE} -->

<!-- ggplot(BAP.SS.data) + -->
<!--   geom_boxplot(aes(x = as.factor(DSPPGRP),  -->
<!--                    y = (PRICE), color = as.factor(BAP_1)))+ -->
<!--   scale_color_discrete(labels = c("BAP", "Others")) +  -->
<!--   guides(color = guide_legend(title = NULL)) + -->
<!--   theme(axis.text.x = element_text(angle = 90, vjust = 0.5,  -->
<!--                                    hjust = 1, size = 12)) + -->
<!--   labs(x = "DSPPGRP", title = "Shelf-stable") +  -->
<!--   geom_text(data = p.dif.gt.0.df, -->
<!--             aes(x = as.factor(DSPPGRP),  -->
<!--                 y = max(BAP.SS.data$PRICE),  -->
<!--                 label = signif(p, 2))) -->

<!-- ``` -->
	
# 2.	What is the price of eco-labeled shrimp vs non-ecolabeled shrimp? 
Filter by: 
## A.	MSC - tiny shrimp, P. jordani (these are size tiny, fresh, wild-caught US and Canada) 

```{r P_jordani_data, echo=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, MBA, MSC, BAP) %>%
  filter(SPECIES == "Pandalus jordani") %>%
  mutate(MSC_1 = ifelse(is.na(MSC), 2, 1)) -> P.jordani.data

# find which levels are available as pairs:
# P.jordani.data %>% 
#   filter(MSC_1 == 1) %>%
#   summarize(n = n()) -> MSC_P.jordani_1.summary
# 
# P.jordani.data %>% 
#   filter(MSC_1 == 2) %>%
#   summarize(n = n()) -> MSC_P.jordani_2.summary

P.jordani.data %>% group_by(MSC_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

# sample.size %>% filter(MSC_1 == 1) %>% select(DSPPGRP, n) %>%
#   transmute(DSPPGRP1 = DSPPGRP,
#             n1 = n) -> sample.size.1
# 
# sample.size %>% filter(MSC_1 == 2) %>% select(DSPPGRP, n) %>%
#   transmute(DSPPGRP2 = DSPPGRP,
#             n2 = n)-> sample.size.2
# 
# sample.size.wide <- cbind(sample.size.1, sample.size.2)
```


```{r P_jordani_tests_MSC, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/P_jordani_MSC_test_results.rds")){

    P.jordani.data %>% filter(MSC_1 == 1) %>% 
      pull(PRICE) -> y1
    
    P.jordani.data %>% filter(MSC_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.P.jordani <- BESTmcmc(y1, y2,
                                    numSavedSteps = 10000,
                                    burnInSteps = 5000,
                                    thinSteps = 5,
                                    parallel = TRUE)
      
      
    }
  saveRDS(BESTout.P.jordani, "RData/P_jordani_MSC_test_results.rds")
} else {
  BESTout.P.jordani <- readRDS("RData/P_jordani_MSC_test_results.rds")
}

mu.dif.P.jordani <- summary(BESTout.P.jordani)["muDiff", c("median", "HDIlo", "HDIup")]

mu.dif.P.jordani$signif <- signif.fun(mu.dif.P.jordani)

```


```{r P_jordani_tests_MSC_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of P. jordani between those with and without MSC labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot(P.jordani.data) +
  geom_boxplot(aes(x = as.factor(MSC_1), 
                   y = PRICE)) +
  #scale_color_discrete(labels = c("BAP", "Others")) + 
  #guides(color = guide_legend(title = NULL)) +
  # theme(axis.text.x = element_text(angle = 90, vjust = 0.5, 
  #                                  hjust = 1, size = 12)) +
  scale_x_discrete(breaks = c(1, 2), 
                   labels = c("MSC", "non-MSC")) +
  labs(x = "", title = "P. jordani") + 
   geom_text(data = sample.size,
            aes(x = as.factor(MSC_1), 
                y = (ceiling(max(P.jordani.data$PRICE)) + 5),
                label = n),
            size = 3)  
  # geom_text(data = data.frame(mu.dif.P.jordani),
  #           aes(x = as.factor(1), 
  #               y = max(P.jordani.data$PRICE) + 5, 
  #               label = signif),
  #           size = 10)

```

NO diffrence was found between the mean prices of *P. Jordani* between with and without MSC labels. 


## B.	MBA - white shrimp. L. setiferus  (only one size; fresh, wild caught US & Canada)

```{r MBA_L_setiferus, echo=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, MBA, MSC, BAP) %>%
  filter(SPECIES == "Litopenaeus setiferus") %>%
  filter(is.na(MSC))  %>% # remove MSC certified
  filter(is.na(BAP))  %>% # remove BAP certified
  mutate(MBA_1_2 = ifelse(is.na(MBA), 2, 
                          ifelse((MBA == 1 | MBA == 2), 1, 2)))  -> L.setiferus.data

# find which levels are available as pairs:
# L.setiferus.data %>% 
#   filter(MBA_1_2 == 1) %>%
#   summarize(n = n()) -> MBA_L.setiferus_1.summary
# 
# L.setiferus.data %>% 
#   filter(MBA_1_2 == 2) %>%
#   summarize(n = n()) -> MBA_L.setiferus_2.summary

L.setiferus.data %>% group_by(MBA_1_2, DSPPGRP) %>% summarize(n = n()) -> sample.size 

```


```{r MBA_L_setiferus_test, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/L_setiferus_test_results.rds")){

    L.setiferus.data %>% filter(MBA_1_2 == 1) %>% 
      pull(PRICE) -> y1
    
    L.setiferus.data %>% filter(MBA_1_2 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.L.setiferus <- BESTmcmc(y1, y2,
                                    numSavedSteps = 10000,
                                    burnInSteps = 5000,
                                    thinSteps = 5,
                                    parallel = TRUE)
      
      
    }
  saveRDS(BESTout.L.setiferus, "RData/L_setiferus_test_results.rds")
} else {
  BESTout.L.setiferus <- readRDS("RData/L_setiferus_test_results.rds")
}

mu.dif.L.setiferus <- summary(BESTout.L.setiferus)["muDiff", c("median", "HDIlo", "HDIup")]

mu.dif.L.setiferus$signif <- as.numeric(signif.fun(mu.dif.L.setiferus))

```


```{r L_setiferus_tests_MBA_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap="Comparison of the price of L.setiferus between those with and without MBA 1&2 labels. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot(L.setiferus.data) +
  geom_boxplot(aes(x = as.factor(MBA_1_2), 
                   y = PRICE)) +
  #scale_color_discrete(labels = c("BAP", "Others")) + 
  #guides(color = guide_legend(title = NULL)) +
  # theme(axis.text.x = element_text(angle = 90, vjust = 0.5, 
  #                                  hjust = 1, size = 12)) +
  scale_x_discrete(labels = c("MBA 1&2", "Other")) +
  labs(x = "", title = "L. setiferus") + 
  geom_text(data = sample.size,
            aes(x = as.factor(MBA_1_2), 
                y = (ceiling(max(L.setiferus.data$PRICE)) + 5),
                label = n),
            size = 3)  
# geom_text(data = data.frame(mu.dif.L.setiferus),
#             aes(x = 1, 
#                 y = max(L.setiferus.data$PRICE), 
#                 label = signif))

```

The mean price of *L. setiferus* was higher for MBA certified products. 


## C.	Fair Trade – white and blue shrimp; not giant size; fresh, wild; Del Pacifico product
Northen white shrimp (*Litopenaeus setiferus*) and blue shrimp (*Litopenaeus stylirostris*). What is "Del Pacifico product"? 

```{r FairTrade_L_setiferus, echo=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, ECOLABEL, MBA, MSC, BAP) %>%
  filter(SPECIES == "Litopenaeus setiferus" |
           SPECIES == "Litopenaeus stylirostris") %>%
  mutate(ECOLABEL_f = as.factor(ECOLABEL)) %>%
  filter(is.na(MSC))  %>% # remove MSC certified
  filter(is.na(BAP))  %>% # remove BAP certified
  mutate(EL_1 = ifelse(is.na(ECOLABEL_f), 2, 1)) -> L.setiferus.FairTrade.data

# find which levels are available as pairs:
# L.setiferus.FairTrade.data %>% 
#   filter(EL_1 == 1) %>%
#   summarize(n = n()) ->L.setiferus.FairTrade_1.summary
# 
# L.setiferus.FairTrade.data %>% 
#   filter(EL_1 == 2) %>%
#   summarize(n = n()) -> L.setiferus.FairTrade_2.summary

L.setiferus.FairTrade.data %>% group_by(EL_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

```


```{r FairTrade_L_setiferus_FairTrade_test, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/L_setiferus_FairTrade_test_results.rds")){

    L.setiferus.FairTrade.data %>% filter(EL_1 == 1) %>% 
      pull(PRICE) -> y1
    
    L.setiferus.FairTrade.data %>% filter(EL_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.L.setiferus.FairTrade <- BESTmcmc(y1, y2,
                                    numSavedSteps = 10000,
                                    burnInSteps = 5000,
                                    thinSteps = 5,
                                    parallel = TRUE)
      
      
    }
  saveRDS(BESTout.L.setiferus.FairTrade, "RData/L_setiferus_FairTrade_test_results.rds")
} else {
  BESTout.L.setiferus.FairTrade <- readRDS("RData/L_setiferus_FairTrade_test_results.rds")
}

mu.dif.L.setiferus.FairTrade <- summary(BESTout.L.setiferus.FairTrade)["muDiff", 
                                                                       c("median", "HDIlo", "HDIup")]

mu.dif.L.setiferus.FairTrade$signif <- as.numeric(signif.fun(mu.dif.L.setiferus.FairTrade))

# p.dif.gt.0 <- summary(BESTout.L.setiferus.FairTrade)["muDiff", "%>compVal"] * 0.01
# 
# p.dif.gt.0.df <- data.frame(p = p.dif.gt.0)
```


```{r L_setiferus_tests_FairTrade_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap = "Comparison of the price of L.setiferus between those with fair-trade lables and those without. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot(L.setiferus.FairTrade.data) +
  geom_boxplot(aes(x = as.factor(EL_1), 
                   y = PRICE)) +
  #scale_color_discrete(labels = c("BAP", "Others")) + 
  #guides(color = guide_legend(title = NULL)) +
  # theme(axis.text.x = element_text(angle = 90, vjust = 0.5, 
  #                                  hjust = 1, size = 12)) +
  scale_x_discrete(labels = c("Fair trade", "Other")) +
  labs(x = "", title = "L. setiferus") + 
  geom_text(data = sample.size,
            aes(x = as.factor(EL_1), 
                y = (ceiling(max(L.setiferus.FairTrade.data$PRICE)) + 5),
                label = n),
            size = 3)  
# geom_text(data = data.frame(mu.dif.L.setiferus.FairTrade),
#             aes(x = 1, 
#                 y = max(L.setiferus.FairTrade.data$PRICE), 
#                 label = signif))

```

The mean price of *L. setiferus* was higher for fair-trace certified products. 



## D.	BAP whiteleg shrimp (farmed)
```{r BAP_L_vannamei, echo=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, MBA, MSC, BAP) %>%
  filter(SPECIES == "Litopenaeus vannamei") %>%
  filter(is.na(MSC))  %>% # remove MSC certified
  filter(is.na(MBA))  %>% # remove BAP certified
  mutate(BAP_1 = ifelse(is.na(BAP), 2, 1)) -> L.vannamei.BAP.data

# find which levels are available as pairs:
# L.vannamei.BAP.data %>% 
#   filter(BAP_1 == 1) %>%
#   summarize(n = n()) ->L.vannamei.BAP_1.summary
# 
# L.vannamei.BAP.data %>% 
#   filter(BAP_1 == 2) %>%
#   summarize(n = n()) -> L.vannamei.BAP_2.summary

L.vannamei.BAP.data %>% group_by(BAP_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

```


```{r BAP_L_vannamei_test, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/L_vannamei_BAP_test_results.rds")){

    L.vannamei.BAP.data %>% filter(BAP_1 == 1) %>% 
      pull(PRICE) -> y1
    
    L.vannamei.BAP.data %>% filter(BAP_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.L.bannamei_BAP <- BESTmcmc(y1, y2,
                                    numSavedSteps = 10000,
                                    burnInSteps = 5000,
                                    thinSteps = 5,
                                    parallel = TRUE)
      
      
    }
  saveRDS(BESTout.L.bannamei_BAP, "RData/L_vannamei_BAP_test_results.rds")
} else {
  BESTout.L.bannamei_BAP <- readRDS("RData/L_vannamei_BAP_test_results.rds")
}

mu.dif.L.bannamei_BAP <- summary(BESTout.L.bannamei_BAP)["muDiff", 
                                                         c("median", "HDIlo", "HDIup")]

mu.dif.L.bannamei_BAP$signif <- as.numeric(signif.fun(mu.dif.L.bannamei_BAP))

# p.dif.gt.0 <- summary(BESTout.L.setiferus.FairTrade)["muDiff", "%>compVal"] * 0.01
# 
# p.dif.gt.0.df <- data.frame(p = p.dif.gt.0)
```


```{r BAP_L_vannamei_test_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap = "Comparison of the price of L.setiferus between those with BAP lables and those without. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot(L.vannamei.BAP.data) +
  geom_boxplot(aes(x = as.factor(BAP_1), 
                   y = PRICE)) +
  #scale_color_discrete(labels = c("BAP", "Others")) + 
  #guides(color = guide_legend(title = NULL)) +
  # theme(axis.text.x = element_text(angle = 90, vjust = 0.5, 
  #                                  hjust = 1, size = 12)) +
  scale_x_discrete(labels = c("BAP", "Other")) +
  labs(x = "", title = "L. vannamei") + 
  geom_text(data = sample.size,
            aes(x = as.factor(BAP_1), 
                y = (ceiling(max(L.vannamei.BAP.data$PRICE)) + 5),
                label = n),
            size =3)  
  # geom_text(data = data.frame(mu.dif.L.bannamei_BAP),
  #           aes(x = 1, 
  #               y = max(L.vannamei.BAP.data$PRICE), 
  #               label = signif))

```

The mean price of *L. vannamei* was higher for BAP certified products. 

## E.	BAP giant tiger prawn (farmed)
Please compare price/lb of the same species, size and fresh/farmed with & w/o these labels

*Penaeus monodon*
```{r P_monodon_data, echo=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, MBA, MSC, BAP) %>%
  filter(SPECIES == "Penaeus monodon") %>%
  filter(is.na(MSC))  %>% # remove MSC certified
  filter(is.na(MBA))  %>% # remove BAP certified
  mutate(BAP_1 = ifelse(is.na(BAP), 2, 1)) -> P.monodon.BAP.data

P.monodon.BAP.data %>% group_by(BAP_1, DSPPGRP) %>% summarize(n = n()) -> sample.size 

```



```{r BAP_P_monodon_test, echo=FALSE, include=FALSE, cache=TRUE}

if (!file.exists("RData/P_monodon_BAP_test_results.rds")){

    P.monodon.BAP.data %>% filter(BAP_1 == 1) %>% 
      pull(PRICE) -> y1
    
    P.monodon.BAP.data %>% filter(BAP_1 == 2) %>% 
      pull(PRICE) -> y2
    
    if (var(y1) > 0 & var(y2) > 0 & !is.na(var(y1)) & !is.na(var(y2))){
      BESTout.P.monodon_BAP <- BESTmcmc(y1, y2,
                                    numSavedSteps = 10000,
                                    burnInSteps = 5000,
                                    thinSteps = 5,
                                    parallel = TRUE)
      
      
    }
  saveRDS(BESTout.P.monodon_BAP, "RData/P_monodon_BAP_test_results.rds")
} else {
  BESTout.P.monodon_BAP <- readRDS("RData/P_monodon_BAP_test_results.rds")
}

mu.dif.P.monodon_BAP <- summary(BESTout.P.monodon_BAP)["muDiff", 
                                                       c("median", "HDIlo", "HDIup")]

mu.dif.P.monodon_BAP$signif <- as.numeric(signif.fun(mu.dif.P.monodon_BAP))

# p.dif.gt.0 <- summary(BESTout.P.monodon_BAP)["muDiff", "%>compVal"] * 0.01
# 
# p.dif.gt.0.df <- data.frame(p = p.dif.gt.0)
```


```{r BAP_P_monodon_test_plot, echo=FALSE, fig.width=8, fig.height=6, fig.cap = "Comparison of the price of P. monodon between those with BAP lables and those without. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot(P.monodon.BAP.data) +
  geom_boxplot(aes(x = as.factor(BAP_1), 
                   y = PRICE)) +
  #scale_color_discrete(labels = c("BAP", "Others")) + 
  #guides(color = guide_legend(title = NULL)) +
  # theme(axis.text.x = element_text(angle = 90, vjust = 0.5, 
  #                                  hjust = 1, size = 12)) +
  scale_x_discrete(labels = c("BAP", "Other")) +
  labs(x = "", title = "P. monodon") + 
  geom_text(data = sample.size,
            aes(x = as.factor(BAP_1), 
                y = (ceiling(max(P.monodon.BAP.data$PRICE)) + 5),
                label = n),
            size = 3)  
  # geom_text(data = data.frame(mu.dif.P.monodon_BAP),
  #           aes(x = 1, 
  #               y = max(P.monodon.BAP.data$PRICE), 
  #               label = signif))

```

No difference was found in the mean price of *P. monodon* with or without BAP labels. 

# 3.	Litopenaeus (white or whiteleg shrimp) - price for wild-ecolabel; wild-no ecolabel; farmed- ecolabel; farmed-no ecolabel. 
*Litopenaeus setiferus* and *Litopenaeus vannamei*

Wild ecolabel vs. Wild no ecolabel vs. farmed ecolabel vs. farmed no ecolabel
```{r Litopenaeus_data, echo=FALSE, include=FALSE}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
         SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
         SPECIES, MBA, MSC, BAP, PROD_METHOD, ECOLABEL, WILD, FARMED) %>%
  filter(SPECIES == "Litopenaeus setiferus" | 
           SPECIES == "Litopenaeus vannamei") %>%
  mutate(PROD_METHOD_f = as.factor(PROD_METHOD),
         ECOLABEL_f = as.factor(ECOLABEL),
         ECOLABEL_I = ifelse(is.na(ECOLABEL), 0, 1),
         WILD_I = ifelse(is.na(WILD), 0, 1)) %>%
  mutate(GRP = ifelse((WILD_I == 1 & ECOLABEL_I == 1), 1,   # wild and ecolabel
                      ifelse((WILD_I == 1 & ECOLABEL_I == 0), 2,   # wild and non-ecolabel
                             ifelse((WILD_I == 0 & ECOLABEL_I == 1), 3, 4)))) -> Litopenaeus.data

# sample sizes for different groups:
Litopenaeus.data %>% group_by(GRP) %>%
  summarize(n = n()) -> Litopenaeus.n

# Need to put PRICE and GRP in a long format:
Litopenaeus.data %>% select(PRICE, GRP) %>%
  #mutate(GRP_f = as.factor(GRP)) %>%
  gather(GRP, PRICE) %>%
  mutate(GRP_f = as.factor(GRP)) -> Litopenaeus.long

Litopenaeus.long$GRP_f <- as.factor(Litopenaeus.long$GRP)

Litopenaeus.long$ID <- seq(from = 1, to = nrow(Litopenaeus.long))

if (!file.exists("RData/Litopenaeus_BANOVA_out.rds")){
  Litopenaeus.BANOVA <- BANOVA.Normal(l1_formula = PRICE ~ GRP_f, 
                                      data = data.frame(Litopenaeus.long),
                                      id = Litopenaeus.long$ID,
                                      l1_hyper = c(1, 1, 1))
  saveRDS(tmp, file = "RData/Litopenaeus_BANOVA_out.rds")
} else {
  Litopenaeus.BANOVA <- readRDS("RData/Litopenaeus_BANOVA_out.rds")
}

  
```


```{r Litopenaeus_plot, echo=FALSE, warning=FALSE, fig.width=8, fig.height=6, fig.cap = "Comparison of the price of P. monodon between those with BAP lables and those without. A box indicates 25 to 75 percentiles of data, the horizontal line within each box indicates the mean, whiskers indicate 1.5 times the interquartile range (25 - 75 percentiles) percentiles and dots indicate those outside of the IQR. Values indicate the sample sizes."}

ggplot() + 
  geom_boxplot(data = Litopenaeus.long, 
               aes(x = GRP_f, y = PRICE)) + 
  scale_x_discrete(breaks = c(1, 2, 3, 4),
                   labels = c("wild/ecolabel", "wild/no-ecolable", 
                              "farmed/ecolabel", "farmed/no-ecolabel")) + 
  geom_text(data = Litopenaeus.n, 
            aes(x = GRP, 
                y = ceiling(max(Litopenaeus.long$PRICE)) + 5,
                label = n),
            size = 3) + 
  labs(x = "", y = "Price", title = "Litopenaeus")

```

Differences among the four groups were all significant.  

# 4.	Shrimp by processing
All penaeid shrimp - Filter by processing “head on”, “headless”, “tail on”, “tail off”, and “cooked”
	Please compare price/lb 

```{r}
main.data %>% select(DATE, ZIP, LATITUDE, LONGITUDE, MKT_NAME,
                     SPP_GROUP, DSPPGRP, PRICE, COUNTRY, DCONDITION, SHRIMP,
                     SPECIES, FAMILY, MBA, MSC, BAP, PROD_METHOD, ECOLABEL, WILD, FARMED,
                     SHRIMP_PROCESSING) %>% 
  filter(FAMILY == "Penaeidae") -> tmp
   #-> Penaeid.data
```


